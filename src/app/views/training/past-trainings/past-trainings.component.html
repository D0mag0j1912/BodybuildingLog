<ion-header>
    <ion-toolbar class="toolbar-title">
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>{{ 'navigation.past_trainings' | translate }}</ion-title>
    </ion-toolbar>
</ion-header>
<ion-content>
    <ng-container *ngIf="pastTrainings$ | async as pastTrainings">
        <bl-show-by-day
            *ngIf="periodEmitted === 'day'"
            [startOfWeek]="pastTrainings.Value?.Results?.Dates?.StartDate"
            (dayActivated)="onDayActivated($event)"></bl-show-by-day>
        <ng-container *ngIf="pastTrainings?.IsError; else valueOrLoading">
            <div class="error-wrapper">
                <img
                    class="error-image"
                    src="../../../../assets/svgs/error1.svg">
                <h3 class="error-title">
                    {{ 'training.past_trainings.errors.past_trainings_error_title' | translate }}
                </h3>
                <span class="error-description">
                    {{ 'training.past_trainings.errors.past_trainings_error_description' | translate }}
                </span>
                <ion-button
                    color="primary"
                    type="button"
                    (click)="tryAgain()">
                    {{ 'common.try_again' | translate }}
                </ion-button>
            </div>
        </ng-container>
        <ng-template #valueOrLoading>
            <bl-past-trainings-filters
                (trainingEmitted)="searchEmitted($event)"
                (periodEmitted)="onPeriodEmitted($event)"></bl-past-trainings-filters>
            <ng-container *ngIf="pastTrainings?.IsLoading; else value">
                <ion-spinner
                    class="ion-spinner-class"
                    name="crescent"
                    color="primary"></ion-spinner>
            </ng-container>
            <ng-template #value>
                <ng-container *ngIf="(isSearch$ | async) && pastTrainings?.Value?.TotalCount === 0; else otherCases">
                    <ion-list class="ion-text-center">
                        <ion-item lines="none">
                            <img
                                class="search-not-found-img"
                                src="../../../../assets/svgs/not-found.svg">
                        </ion-item>
                        <ion-item lines="none">
                            <ion-text class="search-not-found-title">
                                {{ 'training.past_trainings.filters.search_no_result_title' | translate }}
                            </ion-text>
                        </ion-item>
                        <ion-item lines="none">
                            <ion-text class="search-not-found-description">
                                {{ 'training.past_trainings.filters.search_no_result_description' | translate }}
                            </ion-text>
                        </ion-item>
                    </ion-list>
                </ng-container>
                <ng-template #otherCases>
                    <ion-card class="card-info-wrapper ion-text-center">
                        <ion-card-header>
                            <ion-card-title class="header-title">
                                <div
                                    #timePeriod
                                    [innerHTML]="setTimePeriod(pastTrainings.Value?.Results?.Dates) | async"></div>
                            </ion-card-title>
                        </ion-card-header>
                        <ion-card-content>
                            <strong class="food-key">
                                {{ ('common.food' | translate) + ': ' }}
                            </strong>
                            <span class="food-value">{{ food + ' ' + ('common.kcal' | translate) }}</span>
                        </ion-card-content>
                    </ion-card>
                    <div
                        *ngIf="pastTrainings.Value?.TotalCount > 0; else noTrainings"
                        #itemWrapper
                        class="training-item-wrapper"
                        [class.no-trainings]="pastTrainings.Value?.TotalCount === 0">
                        <bl-training-item
                            *ngFor="let training of pastTrainings.Value?.Results?.Trainings"
                            [training]="training"></bl-training-item>
                    </div>
                    <ng-template #noTrainings>
                        <section class="no-trainings">
                            <ng-container *ngIf="!(isSearch$ | async) && pastTrainings.Value?.TotalCount === 0;">
                                <h1 class="no-trainings-title">
                                    {{ 'training.past_trainings.no_trainings' | translate }}
                                </h1>
                                <ion-button
                                    mode="md"
                                    class="no-trainings-button"
                                    type="button"
                                    routerLink="/training/new-training"
                                    routerDirection="forward"
                                    color="primary">
                                    {{ 'training.past_trainings.log_training' | translate }}
                                </ion-button>
                            </ng-container>
                        </section>
                    </ng-template>
                    <bl-pagination
                        [isSearch]="isSearch$ | async"
                        [page]="page"
                        [size]="size"
                        [isPreviousPage]="isPreviousPage"
                        [isNextPage]="isNextPage"
                        [data]="pastTrainings"
                        (paginatorChanged)="onPaginatorChanged($event)"></bl-pagination>
                </ng-template>
            </ng-template>
        </ng-template>
    </ng-container>
</ion-content>
